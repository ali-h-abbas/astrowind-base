---
import Layout from '~/layouts/LandingLayout.astro';

import Hero from '~/components/widgets/Hero.astro';
import Features3 from '~/components/widgets/Features3.astro';
import Steps from '~/components/widgets/Steps.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';

const metadata = {
  title: '21-Day Meditation Bootcamp - Transform Your Mind',
  description: 'Join our transformative 21-day meditation bootcamp and build a lasting daily practice.',
};

// TODO: Replace with actual Sutra checkout URL
const SUTRA_CHECKOUT_URL = import.meta.env.SUTRA_CHECKOUT_URL || 'https://sutra.co/checkout/meditation-bootcamp';
---

<Layout metadata={metadata}>
  <!-- Hero Section ******************* -->
  <Hero
    tagline="21-Day Meditation Bootcamp"
    title="Transform Your Mind in 21 Days"
    actions={[
      {
        variant: 'primary',
        text: 'Reserve Your Spot',
        href: '#signup',
        icon: 'tabler:arrow-down-circle',
      },
    ]}
  >
    <Fragment slot="subtitle">
      Join hundreds of students who have discovered inner peace and mental clarity through our structured meditation
      program.
      <br /><br />
      <strong>Daily guided sessions â€¢ Lifetime access â€¢ Supportive community</strong>
    </Fragment>
  </Hero>

  <!-- Email Capture Form Section ******************* -->
  <section id="signup" class="scroll-mt-16 px-4 py-16 mx-auto max-w-3xl md:px-6 md:py-20">
    <div class="bg-blue-50 dark:bg-slate-800 p-8 md:p-12 rounded-2xl shadow-lg">
      <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 dark:text-white">Get Early Access</h2>
      <p class="text-center text-lg mb-8 text-gray-700 dark:text-gray-300">
        Reserve your spot in the next cohort. Limited spaces available.
      </p>

      <!-- Email Capture Form -->
      <form id="signup-form" class="space-y-4">
        <div>
          <label for="name" class="block text-sm font-medium mb-2 dark:text-white">Full Name</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-900 dark:text-white"
            placeholder="Sarah Chen"
          />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium mb-2 dark:text-white">Email Address</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-900 dark:text-white"
            placeholder="sarah@example.com"
          />
        </div>

        <button
          type="submit"
          id="submit-btn"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span id="submit-text">Reserve My Spot</span>
          <span id="loading-text" class="hidden">Processing...</span>
        </button>
      </form>

      <!-- Success Message (Hidden by default) -->
      <div
        id="success-message"
        class="hidden mt-6 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"
      >
        <h3 class="text-xl font-bold text-green-800 dark:text-green-400 mb-2">ðŸŽ‰ You're In!</h3>
        <p class="text-green-700 dark:text-green-300 mb-4">
          Thank you for reserving your spot! Check your email for next steps.
        </p>
        <a
          href={SUTRA_CHECKOUT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block w-full text-center bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200"
        >
          Complete Your Enrollment â†’
        </a>
      </div>

      <!-- Error Message (Hidden by default) -->
      <div
        id="error-message"
        class="hidden mt-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"
      >
        <p class="text-red-700 dark:text-red-300" id="error-text"></p>
      </div>
    </div>
  </section>

  <!-- Benefits Section ******************* -->
  <Features3
    title="What You'll Experience"
    subtitle="Build a sustainable meditation practice that transforms your daily life"
    columns={3}
    items={[
      {
        title: 'Daily Guided Sessions',
        description: '10-15 minute guided meditations delivered to your inbox each day for 21 days.',
        icon: 'tabler:clock',
      },
      {
        title: 'Reduce Stress & Anxiety',
        description: 'Learn proven techniques to calm your mind and manage stress effectively.',
        icon: 'tabler:heart',
      },
      {
        title: 'Build Lasting Habits',
        description: 'Establish a consistent practice that lasts well beyond the 21 days.',
        icon: 'tabler:target',
      },
      {
        title: 'Improve Focus',
        description: 'Enhance your concentration and mental clarity for work and life.',
        icon: 'tabler:bulb',
      },
      {
        title: 'Better Sleep',
        description: 'Develop relaxation skills that help you sleep more deeply.',
        icon: 'tabler:moon',
      },
      {
        title: 'Supportive Community',
        description: 'Connect with fellow practitioners on the same journey.',
        icon: 'tabler:users',
      },
    ]}
  />

  <!-- What's Included Section ******************* -->
  <Steps
    title="Your 21-Day Journey"
    items={[
      {
        title: 'Week 1: Foundation',
        description: 'Learn the basics of breath awareness and body scanning. Establish your daily practice routine.',
        icon: 'tabler:number-1',
      },
      {
        title: 'Week 2: Deepening',
        description: 'Explore loving-kindness meditation and mindfulness techniques. Build on your foundation.',
        icon: 'tabler:number-2',
      },
      {
        title: 'Week 3: Integration',
        description: 'Learn to bring mindfulness into daily activities. Create a sustainable long-term practice.',
        icon: 'tabler:number-3',
      },
      {
        title: 'Beyond: Lifetime Access',
        description: 'Keep all recordings and resources forever. Continue your practice at your own pace.',
        icon: 'tabler:infinity',
      },
    ]}
    classes={{ container: 'max-w-3xl' }}
  />

  <!-- FAQ Section ******************* -->
  <FAQs
    title="Common Questions"
    items={[
      {
        title: 'Do I need any prior meditation experience?',
        description:
          'Not at all! This bootcamp is designed for complete beginners. We start with the basics and guide you step-by-step.',
      },
      {
        title: 'How much time do I need each day?',
        description:
          'Plan for 10-15 minutes daily for the guided meditation, plus a few minutes for reflection. The sessions are designed to fit into busy schedules.',
      },
      {
        title: 'What if I miss a day?',
        description:
          'Life happens! You can pick up where you left off. All recordings are available for lifetime access, so you can go at your own pace.',
      },
      {
        title: 'Is this a live program?',
        description:
          "The meditations are pre-recorded for maximum flexibility. However, you'll have access to our community forum for questions and support.",
      },
      {
        title: 'What do I need to get started?',
        description: 'Just a quiet space and a device to listen to the audio guides. No special equipment required.',
      },
      {
        title: "What if meditation doesn't work for me?",
        description:
          "While we can't guarantee specific results, our structured approach has helped hundreds of students build a lasting practice. Give it the full 21 days - that's when the real transformation begins.",
      },
    ]}
  />

  <!-- Final CTA Section ******************* -->
  <CallToAction
    title="Ready to Begin Your Transformation?"
    subtitle="Join the next cohort and discover the peace that comes with a consistent meditation practice."
    actions={[
      {
        variant: 'primary',
        text: 'Reserve Your Spot',
        href: '#signup',
      },
    ]}
  />
</Layout>

<!-- Client-side JavaScript for form handling -->
<script>
  // Declare gtag for Google Analytics (if available)
  declare global {
    interface Window {
      gtag?: (command: string, eventName: string, params?: Record<string, string>) => void;
    }
  }

  const form = document.getElementById('signup-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const submitText = document.getElementById('submit-text') as HTMLSpanElement;
  const loadingText = document.getElementById('loading-text') as HTMLSpanElement;
  const successMessage = document.getElementById('success-message') as HTMLDivElement;
  const errorMessage = document.getElementById('error-message') as HTMLDivElement;
  const errorText = document.getElementById('error-text') as HTMLParagraphElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Reset messages
    successMessage.classList.add('hidden');
    errorMessage.classList.add('hidden');

    // Get form data
    const formData = new FormData(form);
    const data = {
      name: formData.get('name') as string,
      email: formData.get('email') as string,
      source: 'meditation-bootcamp',
    };

    // Show loading state
    submitBtn.disabled = true;
    submitText.classList.add('hidden');
    loadingText.classList.remove('hidden');

    try {
      // Use dynamic base path for API endpoint
      const basePath = import.meta.env.BASE_PATH || '';
      const response = await fetch(`${basePath}/api/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok && result.success) {
        // Show success message and hide form
        form.classList.add('hidden');
        successMessage.classList.remove('hidden');

        // Track conversion (you can add analytics here)
        if (typeof window.gtag !== 'undefined') {
          window.gtag('event', 'generate_lead', {
            event_category: 'engagement',
            event_label: 'meditation_bootcamp_signup',
          });
        }
      } else {
        // Show error message
        errorText.textContent = result.error || 'Something went wrong. Please try again.';
        errorMessage.classList.remove('hidden');
      }
    } catch (error) {
      console.error('Submission error:', error);
      errorText.textContent = 'Network error. Please check your connection and try again.';
      errorMessage.classList.remove('hidden');
    } finally {
      // Reset button state
      submitBtn.disabled = false;
      submitText.classList.remove('hidden');
      loadingText.classList.add('hidden');
    }
  });
</script>
